<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hisse Portföyüm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        /* Üst Başlık */
        .header {
            background-color: #eaeaea;
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .header h1 {
            flex: 1;
            text-align: center;
            font-size: 20px;
            margin: 0;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        .back-icon { font-size: 20px; cursor: pointer; padding: 5px; }

        /* Izgara Yapısı (Grid Layout) */
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1.2fr 1fr;
            align-items: center;
        }

        /* Sütun Başlıkları */
        .table-header {
            font-size: 13px;
            color: #666;
            border-bottom: 1px solid #eee;
        }
        .table-header div { text-align: right; }
        
        /* Ayarlar Kutusu */
        .table-header .col-settings { 
            text-align: center; 
            color: #5b7199; 
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #f3f3f3;
            border-radius: 0px;
            padding: 0px;
            width: 100%;
            height: 45px;
            justify-self: start;
            margin: 0;
            box-sizing: border-box;
            border-left: none;
            cursor: pointer;
        }
        .table-header .col-symbol { text-align: left; padding-left: 10px; }

        /* Hisse Satırları */
        .portfolio-row {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .main-data {
            font-size: 15px;
        }
        .col-symbol { font-weight: normal; text-align: left; padding-left: 10px; text-transform: uppercase; }
        .col-val { text-align: right; padding-right: 5px; }
        .col-kz {
            text-align: right;
            padding-right: 5px;
            line-height: 1;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        .red { color: #d9534f; font-weight: bold; }
        .green { color: #5cb85c; font-weight: bold; }

        /* Toplam Satırı */
        .total-row {
            padding: 12px 0;
            font-weight: bold;
            font-size: 15px;
            border-top: 2px solid #eee;
            background-color: #fff;
        }
        .total-label {
            grid-column: 1 / 4;
            text-align: left;
            padding-left: 10px;
        }
        .total-value {
            text-align: right;
            padding-right: 5px;
        }

        /* Gizlenebilir Admin Paneli */
        #adminPanel {
            display: none;
            background: #f4f4f4;
            padding: 15px;
            border-bottom: 2px solid #ddd;
        }

        /* Form ve Butonlar */
        .form-container {
            margin-top: 10px;
        }
        .form-row { display: flex; gap: 5px; margin-bottom: 8px; align-items: center; }
        .form-row label { width: 80px; font-size: 12px; font-weight: bold; }
        input, select { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        button { flex: 1; min-width: 80px; padding: 10px; border: none; border-radius: 4px; cursor: pointer; color: black; font-weight: bold; }
        
        .btn-add { background-color: #2c3e50; }
        .btn-upd { background-color: #2980b9; }
        .btn-del { background-color: #c0392b; }
        .btn-sync { background-color: #27ae60; width: 100%; margin-top: 10px; }
        .btn-reset { background-color: #7f8c8d; width: 100%; margin-top: 15px; font-size: 11px; opacity: 0.8; }

        /* Alt Navigasyon */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background: #eaeaea;
            padding: 8px 0;
            border-top: 1px solid #eee;
            font-size: 14px;
            color: #888;
            z-index: 100;
        }
        .nav-item { text-align: center; }
        .active-nav { color: #000; font-weight: normal; }
    </style>
</head>
<body>

    <div class="header">
        <div class="back-icon" onclick="history.back()">
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="15" y1="12" x2="5" y2="12" />
              <path d="M10 6 L4 12 L10 18" />
            </svg>
        </div>
       <h1 onclick="toggleAdminPanel()">Hisse Portföyüm</h1>
    </div>

    <!-- Tablo Başlığı -->
    <div class="table-header grid-layout">
        <div class="col-settings">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12.122 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        </div>
        <div>Maliyet</div>
        <div>Miktar</div>
        <div>K/Z</div>
        <div>Kapanış</div>
    </div>

			
<!-- Tablo için div yapısı -->
    <div id="hisseTableBody"></div>

    <div class="total-row grid-layout">
        <div class="total-label">Toplam</div>
        <div id="totalProfit" class="total-value red">0,00</div>
        
    </div>
    <div class="portfolio2-row"></div>

  

<script>
        function sayfayiYenile() {
            location.reload();
        }
    </script>
    <!-- Tıklandığında Açılan Panel -->
    <div id="adminPanel">
<!-- Fiyat Güncelleme Butonu -->
        <button class="btn-sync" onclick="sayfayiYenile()">Mynet'ten Fiyatları Güncelle</button>
         
        
<div class="form-container">
    <form id="updateForm">
        <div class="form-row">
            <label for="hisseAd">Hisse Adı:</label>
            <input type="text" id="hisseAd" required>
        </div>
        <div class="form-row">
            <label for="maliyet">Maliyet:</label>
            <input type="text" id="maliyet" step="0.01" required>
        </div>
        <div class="form-row">
            <label for="adet">Adet:</label>
            <input type="number" id="adet" step="1" required>
        </div>
        <div class="form-row">
            <label for="fiyat">Fiyat:</label>
            <input type="number" id="fiyat" step="0.01" required>
        </div>

        <select id="hisseSelect" onchange="hisseSec()">
        <option value="">Bir hisse seçin</option>
		</select>
        <button type="button" onclick="ekleHisse()">Ekle</button>
        <button type="button" onclick="guncelleHisse()">Güncelle</button>
        <button type="button" onclick="silHisse()">Sil</button>
		
    </form>
</div>    
   <br><br>
        <button class="btn-reset" onclick="verileriSifirla()">Verileri Sıfırla</button>

</div>    


    <div class="bottom-nav">
        <div class="nav-item"><svg width="25" height="25" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <line x1="8" y1="6" x2="21" y2="6"></line>
  <line x1="8" y1="12" x2="21" y2="12"></line>
  <line x1="8" y1="18" x2="21" y2="18"></line>
  <line x1="3" y1="6" x2="3.3" y2="6.3"></line>
  <line x1="3" y1="12" x2="3.3" y2="12.3"></line>
  <line x1="3" y1="18" x2="3.3" y2="18.3"></line>
  <line x1="3.3" y1="6" x2="3" y2="6.3"></line>
  <line x1="3.3" y1="12" x2="3" y2="12.3"></line>
  <line x1="3.3" y1="18" x2="3" y2="18.3"></line>
</svg><br>Ekranım</div>
        <div class="nav-item"><svg width="25" height="25" viewBox="0 0 28 28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <polyline points="21 14 18 14 16 9 12 23 9 0 6 14 2 14"></polyline><circle cx="23" cy="14" r="2" fill="none"></circle>

</svg><br>Piyasalar</div>
        <div class="nav-item"><svg width="25" height="25" viewBox="0 0 24 24" fill="none">
  <path d="M17 6H21V18C21 19.6569 19.6569 21 18 21H17" 
        stroke="#777" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />

  <polyline points="3,3 17,3 17,19 18,21 3,21 3,2.35" 
            stroke="#777" 
            fill="none" 
            stroke-width="1.5" stroke-linejoin="round"/>

  <rect x="5" y="6" width="4" height="4" rx="0.5" fill="#777"/>

  <line x1="10.5" y1="7" x2="14" y2="7" stroke="#777" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="10.5" y1="9.5" x2="14" y2="9.5" stroke="#777" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="5.5" y1="12" x2="14" y2="12" stroke="#777" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="5.5" y1="14.5" x2="14" y2="14.5" stroke="#777" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="5.5" y1="17" x2="14" y2="17" stroke="#777" stroke-width="1.5" stroke-linecap="round"/>
</svg>
<br>Haberler</div>
        <div class="nav-item active-nav"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M17 7V5C17 3.89543 16.1046 3 15 3H9C7.89543 3 7 3.89543 7 5V7H4C2.89543 7 2 7.89543 2 9V11H22V9C22 7.89543 21.1046 7 20 7H17ZM9 5H15V7H9V5Z" fill="currentColor"/>
  
  <path d="M2 12V18C2 19.1046 2.89543 20 4 20H20C21.1046 20 22 19.1046 22 18V12H15V13H9V12H2Z" fill="currentColor"/>
</svg><br>Portföyüm</div>
    </div>




<script>
    let hisseler = [];
    
    // Panel Aç/Kapat
    function toggleAdminPanel() {
        const panel = document.getElementById("adminPanel");
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            panel.style.display = "block";
        }
    }
    // Yerel Ayarları Al (Türkçe için binlik ayraç nokta, ondalık virgül)
    const trLocale = { minimumFractionDigits: 2, maximumFractionDigits: 2 };
    
    // Sayfa yüklendiğinde veriyi çek ve benzersiz id ataması yap
    document.addEventListener('DOMContentLoaded', () => {
        const kayitliHisseler = localStorage.getItem('hisseler_2');
        if (kayitliHisseler) {
            hisseler = JSON.parse(kayitliHisseler).map((hisse, index) => ({
                ...hisse,
                id: hisse.id || `hisse-${index + 1}`
            }));
            kaydetVeGuncelle();
        }
    });

    function ekleHisse() {
        const hisse = { ...getFormVerileri(), id: `hisse-${Date.now()}` }; // Benzersiz id oluştur
        hisseler.push(hisse);
        kaydetVeGuncelle();
    }

    function guncelleHisse() {
        const seciliHisseAd = document.getElementById("hisseSelect").value;
        if (!seciliHisseAd) return alert("Güncellemek için bir hisse seçin.");
        
        const index = hisseler.findIndex(h => h.ad === seciliHisseAd);
        if (index !== -1) {
            hisseler[index] = { ...getFormVerileri(), id: hisseler[index].id };
            kaydetVeGuncelle();
        }
    }

    function silHisse() {
        const seciliHisseAd = document.getElementById("hisseSelect").value;
        if (!seciliHisseAd) return alert("Silmek için bir hisse seçin.");
        
        hisseler = hisseler.filter(h => h.ad !== seciliHisseAd);
        kaydetVeGuncelle();
    }

    function kaydetVeGuncelle() {
        localStorage.setItem('hisseler_2', JSON.stringify(hisseler));
        tabloyuGuncelle();
        hisseListesiniGuncelle();
        formuTemizle();
    }
// Uzunluğa göre font boyutunu belirleyen fonksiyon
    function getKZFontSize(value) {
        const textLength = value.length;
        if (textLength > 12) return '10px';
        if (textLength > 10) return '11px';
        if (textLength > 8) return '13px';
        return '15px';
    }
    function tabloyuGuncelle() {
        const tableBody = document.getElementById("hisseTableBody");
        tableBody.innerHTML = "";
        let toplamKZ = 0;
        
        hisseler.forEach((hisse) => {
            const tlKarZarar = (hisse.fiyat - hisse.maliyet) * hisse.adet;
            toplamKZ += tlKarZarar;
            
            const row = document.createElement("div");
            row.classList.add("portfolio-row");
            const karZararRenk = hisse.karZarar < 0 ? "red" : "green";
            const formattedKZ = hisse.karZarar.toLocaleString('tr-TR', trLocale);
            
            // K/Z font boyutu hesaplama
            const fontSize = getKZFontSize(formattedKZ);
            
            row.innerHTML = `
                <div class="main-data grid-layout">
                    <div class="col-symbol">${hisse.ad}</div>
                    <div class="col-val">${hisse.maliyet.toFixed(2)}</div>
                    <div class="col-val">${hisse.adet}</div>
                    
                    <div class="col-kz ${karZararRenk}" style="font-size: ${fontSize};">${parseFloat(hisse.karZarar).toLocaleString('tr-TR', trLocale)}</div>
                    
                    <div class="col-val">${hisse.fiyat.toFixed(2)}</div>
                    
                </div>

            `;
            tableBody.appendChild(row);
        });
        const totalEl = document.getElementById("totalProfit");
        if (totalEl) {
            totalEl.innerText = toplamKZ.toLocaleString('tr-TR', trLocale);
            totalEl.className = `total-value ${toplamKZ < 0 ? "red" : "green"}`;
        }
    }

    function getFormVerileri() {
        const ad = document.getElementById("hisseAd").value.toUpperCase().trim();

        const fiyat = parseFloat(document.getElementById("fiyat").value);
        const maliyet = parseFloat(document.getElementById("maliyet").value);
        const adet = parseInt(document.getElementById("adet").value);

        const karZarar = ((fiyat - maliyet)* adet).toFixed(2);
        return { ad, fiyat, maliyet, adet, karZarar };
    }

    function hisseSec() {
        const seciliHisseAd = document.getElementById("hisseSelect").value;
        if (seciliHisseAd === "") return formuTemizle();
        const hisse = hisseler.find(h => h.ad === seciliHisseAd);
        if (hisse) formuDoldur(hisse);
    }

    function formuDoldur(hisse) {
        document.getElementById("hisseAd").value = hisse.ad;

        document.getElementById("fiyat").value = hisse.fiyat;
        document.getElementById("maliyet").value = hisse.maliyet;
        document.getElementById("adet").value = hisse.adet;

    }

    function formuTemizle() {
        document.getElementById("updateForm").reset();
    }

    function hisseListesiniGuncelle() {
        const select = document.getElementById("hisseSelect");
        select.innerHTML = '<option value="">Bir hisse seçin</option>';
        hisseler.forEach(hisse => {
            const option = document.createElement("option");
            option.value = hisse.ad;
            option.textContent = hisse.ad;
            select.appendChild(option);
        });
    }

	document.addEventListener('DOMContentLoaded', () => {
        console.log("Sayfa yüklendi. Hisse fiyatlarını çekme işlemi başlıyor...");
        guncelFiyatlariGetir();
    });
	
    async function guncelFiyatlariGetir() {
    console.log("Hisse fiyatı çekme işlemi başladı.");
    try {
        console.log("Mynet sitesine istek gönderiliyor...");
        const response = await fetch('https://finans.mynet.com/borsa/hisseler/');
        console.log("Sayfa başarılı bir şekilde yüklendi.");
        const text = await response.text();
        console.log("Sayfa içeriği ayrıştırılıyor...");
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');
        console.log("Tablo satırları seçiliyor...");
        const rows = doc.querySelectorAll('tr');

        rows.forEach(row => {
            try {
                const hisseKod = row.querySelector('strong a')?.textContent.trim(); // Hisse kodu
                const fiyatMetni = row.querySelectorAll('td')[2]?.textContent.trim(); // 3. sütundaki fiyat verisi
                const yeniFiyat = parseFloat(fiyatMetni.replace('.', '').replace(',', '.'));

                if (hisseKod) {
                    console.log(`Hisse kodu: ${hisseKod} bulundu.`);
                    
                    // Hisseyi mevcut hisseler içinde bul
                    hisseler.forEach(hisse => {
                        // -CARI kısmını kaldırarak karşılaştırma yapıyoruz
                        const temizAd = hisse.ad.replace('-CARI', '');
                        if (hisseKod.includes(temizAd)) {
                            console.log(`${hisseKod} güncelleniyor...`);
                            hisse.fiyat = yeniFiyat; // Yeni fiyatı tabloya ata
                            hisse.karZarar = ((yeniFiyat - hisse.maliyet) * hisse.adet).toFixed(2); // Kar zarar güncelle
                        }
                    });
                }
            } catch (err) {
                console.error("Bir hata oluştu:", err);
            }
        });

        kaydetVeGuncelle(); // Güncellenmiş fiyatları kaydet ve güncelle
    } catch (error) {
        console.error("Hata: Fiyat çekme işlemi başarısız oldu.", error);
    }
}
    function verileriSifirla() {
        if(confirm("Tüm kayıtlı hisse bilgileriniz silinecek. Emin misiniz?")) {
            localStorage.removeItem('hisseler');
            hisseler = [];
            tabloyuGuncelle();
            hisseListesiniGuncelle();
            alert("Tüm veriler temizlendi.");
        }
    }


    // Fiyatları her 5 dakikada bir güncelle
    setInterval(guncelFiyatlariGetir, 300000);
</script>



</body>
</html>
