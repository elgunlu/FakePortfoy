<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hisse PortfÃ¶yÃ¼m</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            padding-bottom: 100px; /* Alt navigasyon iÃ§in boÅŸluk */
        }

        /* Ãœst BaÅŸlÄ±k */
        .header {
            background-color: #f9f9f9;
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .header h1 {
            flex: 1;
            text-align: center;
            font-size: 18px;
            margin: 0;
            font-weight: bold;
        }
        .back-icon { font-size: 20px; cursor: pointer; padding: 5px; }

        /* Izgara YapÄ±sÄ± */
        .grid-layout {
            display: grid;
            grid-template-columns: 1.2fr 1fr 1fr 1fr 1fr;
            align-items: center;
        }

        /* SÃ¼tun BaÅŸlÄ±klarÄ± */
        .table-header {
            font-size: 13px;
            color: #666;
            border-bottom: 1px solid #eee;
            background: #fdfdfd;
        }
        .table-header div { text-align: right; padding: 10px 5px; }
        
        .table-header .col-settings { 
            text-align: left; 
            padding-left: 10px;
            display: flex;
            align-items: center;
            color: #5b7199;
        }

        /* Hisse SatÄ±rlarÄ± */
        .portfolio-row {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            flex-direction: column;
        }
        
        .main-data {
            font-size: 14px;
            font-weight: bold;
        }
        
        .col-symbol { text-align: left; padding-left: 10px; text-transform: uppercase; }
        .col-val { text-align: right; padding-right: 5px; }
        
        .sub-row {
            display: flex;
            gap: 10px;
            font-size: 11px;
            color: #777;
            padding-left: 10px;
            margin-top: 4px;
        }

        .red { color: #d9534f; }
        .green { color: #5cb85c; }

        /* Toplam SatÄ±rÄ± */
        .total-row {
            padding: 15px;
            font-weight: bold;
            font-size: 15px;
            border-top: 2px solid #eee;
            display: flex;
            justify-content: space-between;
            background: #fff;
        }

        /* Form AlanÄ± */
        .form-container {
            padding: 15px;
            background: #f4f4f4;
            margin: 10px;
            border-radius: 8px;
        }
        .form-row { display: flex; gap: 5px; margin-bottom: 8px; align-items: center; }
        .form-row label { width: 80px; font-size: 12px; }
        input, select { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; }
        
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; font-size: 13px; }
        
        .btn-add { background-color: #2c3e50; }
        .btn-upd { background-color: #2980b9; }
        .btn-del { background-color: #c0392b; }
        .btn-sync { background-color: #27ae60; width: calc(100% - 20px); margin: 10px; }

        #loadingBar {
            display: none;
            text-align: center;
            padding: 8px;
            background: #fff3cd;
            font-size: 12px;
        }

        /* Alt Navigasyon */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background: #fff;
            padding: 10px 0;
            border-top: 1px solid #eee;
            font-size: 11px;
            color: #888;
        }
        .active-nav { color: #000; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <div class="back-icon" onclick="history.back()">
            <svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="15" y1="12" x2="5" y2="12" />
              <path d="M10 6 L4 12 L10 18" />
            </svg>
        </div>
        <h1>Hisse PortfÃ¶yÃ¼m</h1>
    </div>

    <div id="loadingBar">Fiyatlar gÃ¼ncelleniyor...</div>

    <div class="table-header grid-layout">
        <div class="col-settings">Hisse</div>
        <div>Maliyet</div>
        <div>Miktar</div>
        <div>K/Z (%)</div>
        <div>Son</div>
    </div>

    <div id="hisseTableBody"></div>

    <div class="total-row">
        <span>Toplam DeÄŸer:</span>
        <span id="totalValue">0,00 â‚º</span>
    </div>

    <div class="form-container">
        <form id="updateForm">
            <div class="form-row">
                <input type="text" id="hisseAd" placeholder="Hisse Kodu (Ã–rn: THYAO)" required>
                <input type="text" id="hisseInfo" placeholder="AÃ§Ä±klama">
            </div>
            <div class="form-row">
                <input type="number" id="maliyet" placeholder="Maliyet" step="0.001" required>
                <input type="number" id="adet" placeholder="Adet" step="0.01" required>
            </div>
            <div class="form-row">
                <input type="number" id="fiyat" placeholder="Son Fiyat" step="0.001" required>
                <input type="number" id="t2Adet" placeholder="T2 Adet">
                <input type="number" id="sAdet" placeholder="S. Adet">
            </div>
            
            <select id="hisseSelect" onchange="hisseSec()" style="margin-bottom: 10px; width: 100%;">
                <option value="">DÃ¼zenlemek iÃ§in hisse seÃ§in</option>
            </select>
            
            <div class="btn-group">
                <button type="button" class="btn-add" onclick="ekleHisse()">Ekle</button>
                <button type="button" class="btn-upd" onclick="guncelleHisse()">GÃ¼ncelle</button>
                <button type="button" class="btn-del" onclick="silHisse()">Sil</button>
            </div>
        </form>
    </div>

    <button class="btn-sync" onclick="guncelFiyatlariGetir()">FiyatlarÄ± GÃ¼ncelle</button>

    <div class="bottom-nav">
        <div class="nav-item">â˜°<br>EkranÄ±m</div>
        <div class="nav-item">ðŸ“ˆ<br>Piyasalar</div>
        <div class="nav-item active-nav">ðŸ’¼<br>PortfÃ¶yÃ¼m</div>
    </div>

<script>
    let hisseler = [];

    document.addEventListener('DOMContentLoaded', () => {
        const kayitliHisseler = localStorage.getItem('hisseler_2');
        if (kayitliHisseler) {
            hisseler = JSON.parse(kayitliHisseler);
            tabloyuGuncelle();
            hisseListesiniGuncelle();
        }
    });

    function getFormVerileri() {
        const ad = document.getElementById("hisseAd").value.toUpperCase();
        const info = document.getElementById("hisseInfo").value || "";
        const fiyat = parseFloat(document.getElementById("fiyat").value) || 0;
        const maliyet = parseFloat(document.getElementById("maliyet").value) || 0;
        const adet = parseFloat(document.getElementById("adet").value) || 0;
        const t2Adet = parseFloat(document.getElementById("t2Adet").value) || 0;
        const sAdet = parseFloat(document.getElementById("sAdet").value) || 0;
        
        let karZarar = 0;
        if (maliyet > 0) {
            karZarar = (((fiyat - maliyet) / maliyet) * 100).toFixed(2);
        }

        return { ad, info, fiyat, maliyet, adet, t2Adet, sAdet, karZarar };
    }

    function ekleHisse() {
        const veriler = getFormVerileri();
        if (!veriler.ad) return alert("Hisse adÄ± giriniz.");
        
        const id = `hisse-${Date.now()}`;
        hisseler.push({ ...veriler, id });
        kaydetVeGuncelle();
    }

    function guncelleHisse() {
        const seciliHisseAd = document.getElementById("hisseSelect").value;
        if (!seciliHisseAd) return alert("GÃ¼ncellemek iÃ§in listeden seÃ§in.");
        
        const index = hisseler.findIndex(h => h.ad === seciliHisseAd);
        if (index !== -1) {
            const id = hisseler[index].id;
            hisseler[index] = { ...getFormVerileri(), id };
            kaydetVeGuncelle();
        }
    }

    function silHisse() {
        const seciliHisseAd = document.getElementById("hisseSelect").value;
        if (!seciliHisseAd) return alert("Silmek iÃ§in seÃ§in.");
        
        if(confirm(seciliHisseAd + " silinecek?")) {
            hisseler = hisseler.filter(h => h.ad !== seciliHisseAd);
            kaydetVeGuncelle();
        }
    }

    function kaydetVeGuncelle() {
        localStorage.setItem('hisseler_2', JSON.stringify(hisseler));
        tabloyuGuncelle();
        hisseListesiniGuncelle();
        document.getElementById("updateForm").reset();
    }

    function tabloyuGuncelle() {
        const tableBody = document.getElementById("hisseTableBody");
        tableBody.innerHTML = "";
        let toplamPortfoy = 0;

        hisseler.forEach((hisse) => {
            const row = document.createElement("div");
            row.classList.add("portfolio-row");
            const karZararRenk = hisse.karZarar < 0 ? "red" : "green";
            const guncelDeger = hisse.fiyat * hisse.adet;
            toplamPortfoy += guncelDeger;

            row.innerHTML = `
                <div class="main-data grid-layout" id="${hisse.id}">
                    <div class="col-symbol">${hisse.ad}</div>
                    <div class="col-val">${hisse.maliyet.toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</div>
                    <div class="col-val">${hisse.adet.toLocaleString('tr-TR')}</div>
                    <div class="col-val ${karZararRenk}">%${hisse.karZarar}</div>
                    <div class="col-val">${hisse.fiyat.toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</div>
                </div>
                <div class="sub-row">
                    <span>${hisse.info}</span>
                    <span>T2: ${hisse.t2Adet}</span>
                    <span>S. Adet: ${hisse.sAdet}</span>
                </div>
            `;
            tableBody.appendChild(row);
        });

        document.getElementById("totalValue").textContent = toplamPortfoy.toLocaleString('tr-TR', { minimumFractionDigits: 2 }) + " â‚º";
    }

    function hisseSec() {
        const seciliHisseAd = document.getElementById("hisseSelect").value;
        if (!seciliHisseAd) return;
        const h = hisseler.find(item => item.ad === seciliHisseAd);
        if (h) {
            document.getElementById("hisseAd").value = h.ad;
            document.getElementById("hisseInfo").value = h.info;
            document.getElementById("fiyat").value = h.fiyat;
            document.getElementById("maliyet").value = h.maliyet;
            document.getElementById("adet").value = h.adet;
            document.getElementById("t2Adet").value = h.t2Adet;
            document.getElementById("sAdet").value = h.sAdet;
        }
    }

    function hisseListesiniGuncelle() {
        const select = document.getElementById("hisseSelect");
        select.innerHTML = '<option value="">DÃ¼zenlemek iÃ§in hisse seÃ§in</option>';
        hisseler.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h.ad;
            opt.textContent = h.ad;
            select.appendChild(opt);
        });
    }

    async function guncelFiyatlariGetir() {
        const loader = document.getElementById("loadingBar");
        loader.style.display = "block";
        try {
            const response = await fetch('https://finans.mynet.com/borsa/hisseler/');
            const text = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');
            const rows = doc.querySelectorAll('tr');

            rows.forEach(row => {
                const kod = row.querySelector('strong a')?.textContent.trim();
                const fiyatStr = row.querySelectorAll('td')[2]?.textContent.trim();
                if (kod && fiyatStr) {
                    const yeniFiyat = parseFloat(fiyatStr.replace('.', '').replace(',', '.'));
                    hisseler.forEach(h => {
                        if (kod === h.ad || kod === h.ad.replace('-CARI', '')) {
                            h.fiyat = yeniFiyat;
                            h.karZarar = (((yeniFiyat - h.maliyet) / h.maliyet) * 100).toFixed(2);
                        }
                    });
                }
            });
            kaydetVeGuncelle();
        } catch (e) {
            console.error(e);
        } finally {
            loader.style.display = "none";
        }
    }

    setInterval(guncelFiyatlariGetir, 300000);
</script>
</body>
</html>
